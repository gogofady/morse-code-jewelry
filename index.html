<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  
  <title>Morse Jewelry | Christmas Sale</title>
  <meta property="og:title" content="Morse Jewelry - Personalized Secret Messages" />
  <meta property="og:description" content="Handcrafted jewelry encoding secret messages. Christmas Sale Live Now." />
  <meta property="og:image" content="./morse_logo_transparent.png" />
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" href="./morse_logo_transparent.png" type="image/png">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Jost:wght@300;400;500&family=Oswald:wght@400;500;700&family=Cairo:wght@400;700&display=swap" rel="stylesheet">

  <style>
    /* Typography & Base */
    :root { --primary: #1a1a1a; --accent: #db2777; --gold: #C5A059; }
    body { font-family: 'Jost', sans-serif; letter-spacing: 0.02em; color: var(--primary); background-color: #FAFAFA; }
    h1, h2, h3, h4, .font-heading { font-family: 'Oswald', sans-serif; text-transform: uppercase; letter-spacing: 0.05em; }
    .font-arabic { font-family: 'Cairo', sans-serif; }
    
    /* Animations */
    .fade-in { animation: fadeIn 0.6s ease-out forwards; opacity: 0; transform: translateY(10px); }
    @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
    
    /* Image Hover Zoom Effect */
    .img-zoom-container { overflow: hidden; }
    .img-zoom-container img { transition: transform 0.7s ease; }
    .img-zoom-container:hover img { transform: scale(1.1); }

    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-thumb { background: #ccc; border-radius: 3px; }
  </style>
</head>
<body class="flex flex-col min-h-screen">

<div id="root" class="flex-1 flex flex-col">
    <div class="flex h-screen items-center justify-center bg-white z-50">
        <div class="text-center">
            <img src="./morse_logo_transparent.png" class="h-24 w-auto mx-auto animate-pulse opacity-80">
            <p class="mt-4 text-xs tracking-[0.3em] text-gray-400 uppercase">Loading Christmas Sale</p>
        </div>
    </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

// --- CONFIGURATION ---
const firebaseConfig = {
  apiKey: "AIzaSyDHRFiiklg8k8gmt1QGEstSM5hfTJvIZW8",
  authDomain: "morse-code-jewelry.firebaseapp.com",
  projectId: "morse-code-jewelry",
  storageBucket: "morse-code-jewelry.firebasestorage.app",
  messagingSenderId: "1034331508828",
  appId: "1:1034331508828:web:08acf02e2363000e99d699",
  measurementId: "G-C4WH6X1N1Z"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxuMlTdvd8sJYjNni9vvFEXsgtk8nLjCNqpbDYyjGmMnBX22EK7l3DT86vGnCtCtQyF/exec";

const SHIPPING_COST = 100;
const FREE_SHIPPING_THRESHOLD = 1000;
const GOVERNORATES = ["Cairo", "Giza", "Alexandria", "Dakahlia", "Red Sea", "Beheira", "Fayoum", "Gharbiya", "Ismailia", "Menofia", "Minya", "Qaliubiya", "New Valley", "Suez", "Aswan", "Assiut", "Beni Suef", "Port Said", "Damietta", "Sharkia", "South Sinai", "Kafr Al Sheikh", "Matrouh", "Luxor", "Qena", "North Sinai", "Sohag"];
const MORSE_CODE = { 'a': '.-', 'b': '-...', 'c': '-.-.', 'd': '-..', 'e': '.', 'f': '..-.', 'g': '--.', 'h': '....', 'i': '..', 'j': '.---', 'k': '-.-', 'l': '.-..', 'm': '--', 'n': '-.', 'o': '---', 'p': '.--.', 'q': '--.-', 'r': '.-.', 's': '...', 't': '-', 'u': '..-', 'v': '...-', 'w': '.--', 'x': '-..-', 'y': '-.--', 'z': '--..', '1': '.----', '2': '..---', '3': '...--', '4': '....-', '5': '.....', '6': '-....', '7': '--...', '8': '---..', '9': '----.', '0': '-----', ' ': ' / ' };

// --- TRANSLATIONS ---
const t_data = {
  en: { 
    title: "Morse Jewelry", shop: "Collection", gallery: "Gallery", contact: "Concierge", 
    shipping_banner: "ðŸŽ„ CHRISTMAS SALE ENDING SOON | FREE SHIPPING OVER 1000 EGP", 
    cart_empty: "Your shopping bag is empty", shop_now: "Explore Collection", customize: "Personalize", add_cart: "Add to Bag", free: "Complimentary", total: "Total", original_price: "EGP", payment_section: "Payment Method", pay_cod: "Cash on Delivery", cod_desc: "Pay securely upon receipt.", checkout_title: "Secure Checkout", place_order: "Confirm Order", policy_title: "Policy", policy_link: "Policies", secure_checkout: "Secure Checkout", easy_returns: "Easy Returns", customer_support: "Concierge Support", full_name: "Full Name", phone_1: "Phone Number", phone_2: "Alt Phone", address_section: "Shipping Address", gov_label: "Governorate", district_label: "District", street_label: "Street", building_label: "Building", floor_label: "Floor", apt_label: "Apt", custom_title: "Your Secret Message", custom_hint: "Enter text to translate:", custom_limit: "(Max 10 chars)", contact_us: "Contact Us", send_msg: "Send Message", your_cart: "Your Bag", subtotal: "Subtotal", shipping: "Shipping", clear_cart: "Empty Bag", proceed: "Proceed to Checkout", back_shop: "Back to Collection", you_like: "You May Also Like", spotlight: "Client Spotlight", spotlight_sub: "Real stories in secret code", morse_title: "The Art of Secrecy", morse_desc_1: "Encode your message in timeless jewelry.", morse_desc_2: "Round beads for dots. Long beads for dashes.", morse_secret: "A hidden meaning, known only to you.", hero_title: "Wear Your Story", hero_sub: "Handcrafted jewelry with hidden meaning.", collection: "The Collection", order_success_title: "Thank You", order_success_msg: "We have received your order. Our team will contact you shortly.", close: "Close", phone_error: "Invalid phone number", fill_fields: "Please complete all fields", added_cart: "Added to bag", order_failed: "System Error",
    length_label: "Chain Length", length_guide: "Size Guide", length_select: "Select Length", sale_tag: "XMAS SALE"
  },
  ar: { 
    title: "Ù…ÙˆØ±Ø³ Ù„Ù„Ù…Ø¬ÙˆÙ‡Ø±Ø§Øª", shop: "Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©", gallery: "Ø§Ù„Ù…Ø¹Ø±Ø¶", contact: "ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§", 
    shipping_banner: "ðŸŽ„ Ø®ØµÙˆÙ…Ø§Øª Ø§Ù„ÙƒØ±ÙŠØ³Ù…Ø§Ø³ ØªÙ†ØªÙ‡ÙŠ Ù‚Ø±ÙŠØ¨Ø§Ù‹ | Ø´Ø­Ù† Ù…Ø¬Ø§Ù†ÙŠ ÙÙˆÙ‚ Ù¡Ù Ù Ù  Ø¬.Ù…", 
    cart_empty: "Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚ ÙØ§Ø±ØºØ©", shop_now: "ØªØ³ÙˆÙ‚ Ø§Ù„Ø¢Ù†", customize: "ØªØ®ØµÙŠØµ", add_cart: "Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©", free: "Ù…Ø¬Ø§Ù†ÙŠ", total: "Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ", original_price: "Ø¬.Ù…", payment_section: "Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹", pay_cod: "Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…", cod_desc: "Ø§Ù„Ø¯ÙØ¹ Ø¨Ø£Ù…Ø§Ù† Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù….", checkout_title: "Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø´Ø±Ø§Ø¡", place_order: "ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨", policy_title: "Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª", policy_link: "Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª", secure_checkout: "Ø¯ÙØ¹ Ø¢Ù…Ù†", easy_returns: "Ø³Ù‡ÙˆÙ„Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹", customer_support: "Ø¯Ø¹Ù… ÙÙ†ÙŠ", full_name: "Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„", phone_1: "Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ", phone_2: "Ø±Ù‚Ù… Ø¨Ø¯ÙŠÙ„", address_section: "Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø´Ø­Ù†", gov_label: "Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©", district_label: "Ø§Ù„Ù…Ù†Ø·Ù‚Ø©", street_label: "Ø§Ù„Ø´Ø§Ø±Ø¹", building_label: "Ø§Ù„Ù…Ø¨Ù†Ù‰", floor_label: "Ø§Ù„Ø¯ÙˆØ±", apt_label: "Ø§Ù„Ø´Ù‚Ø©", custom_title: "Ø±Ø³Ø§Ù„ØªÙƒ Ø§Ù„Ø³Ø±ÙŠØ©", custom_hint: "Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… Ù„Ù„ØªØ±Ø¬Ù…Ø©:", custom_limit: "(Ø£Ù‚ØµÙ‰ Ù¡Ù  Ø­Ø±ÙˆÙ)", contact_us: "Ø§ØªØµÙ„ Ø¨Ù†Ø§", send_msg: "Ø¥Ø±Ø³Ø§Ù„", your_cart: "Ø§Ù„Ø­Ù‚ÙŠØ¨Ø©", subtotal: "Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹", shipping: "Ø§Ù„Ø´Ø­Ù†", clear_cart: "Ø¥ÙØ±Ø§Øº Ø§Ù„Ø³Ù„Ø©", proceed: "Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø´Ø±Ø§Ø¡", back_shop: "Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ØªØ¬Ø±", you_like: "Ù‚Ø¯ ÙŠØ¹Ø¬Ø¨Ùƒ Ø£ÙŠØ¶Ø§Ù‹", spotlight: "ØµÙˆØ± Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡", spotlight_sub: "Ù‚ØµØµ Ø­Ù‚ÙŠÙ‚ÙŠØ© Ø¨Ù„ØºØ© Ø³Ø±ÙŠØ©", morse_title: "ÙÙ† Ø§Ù„Ø³Ø±ÙŠØ©", morse_desc_1: "Ø¬Ø³Ø¯ Ø±Ø³Ø§Ù„ØªÙƒ ÙÙŠ Ù…Ø¬ÙˆÙ‡Ø±Ø§Øª Ø®Ø§Ù„Ø¯Ø©.", morse_desc_2: "Ø®Ø±Ø² Ø¯Ø§Ø¦Ø±ÙŠ Ù„Ù„Ù†Ù‚Ø§Ø·. Ø®Ø±Ø² Ø·ÙˆÙŠÙ„ Ù„Ù„Ø´Ø±Ø·Ø§Øª.", morse_secret: "Ù…Ø¹Ù†Ù‰ Ø®ÙÙŠØŒ Ù„Ø§ ÙŠØ¹Ø±ÙÙ‡ Ø³ÙˆØ§Ùƒ.", hero_title: "Ø§Ø±ØªØ¯ÙŠ Ù‚ØµØªÙƒ", hero_sub: "Ù…Ø¬ÙˆÙ‡Ø±Ø§Øª ÙŠØ¯ÙˆÙŠØ© Ø¨Ù…Ø¹Ù†Ù‰ Ø®ÙÙŠ.", collection: "Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©", order_success_title: "Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ", order_success_msg: "ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­. Ø³Ù†ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹.", close: "Ø¥ØºÙ„Ø§Ù‚", phone_error: "Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ­ÙŠØ­", fill_fields: "ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª", added_cart: "ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©", order_failed: "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…",
    length_label: "Ø·ÙˆÙ„ Ø§Ù„Ø³Ù„Ø³Ù„Ø©", length_guide: "Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª", length_select: "Ø§Ø®ØªØ± Ø§Ù„Ø·ÙˆÙ„", sale_tag: "Ø¹Ø±Ø¶ Ø®Ø§Øµ"
  }
};

// --- STATE ---
let currentUserId = null;
const state = {
  lang: 'en', page: 'home', cart: [], selectedProductId: null, showSuccessModal: false, showPolicyModal: false, showSizeGuide: false,
  // Drafts to preserve input
  draftMessage: '', 
  draftLength: '18',
  products: [
    // UPDATED PRICES: 750->450, 550->350
    { id: 1, name: 'Gold Morse Necklace', category: 'necklace', price: 450, originalPrice: 750, description: 'Elegant gold bar necklace encoding a message in dots and dashes.', image: './goldennecklace.avif' },
    { id: 2, name: 'Gold Morse Bracelet', category: 'bracelet', price: 350, originalPrice: 550, description: 'Delicate 14k gold bracelet with a Morse code message.', image: './goldenbracelet.avif' },
    { id: 3, name: 'Silver Morse Necklace', category: 'necklace', price: 450, originalPrice: 750, description: 'Polished silver necklace with a hidden message pattern.', image: './silvernecklace.png' },
    { id: 4, name: 'Silver Cord Bracelet', category: 'bracelet', price: 350, originalPrice: 550, description: 'Cord bracelet set with silver beads for customization.', image: './silverbracelet.webp' },
  ],
  message: '', messageType: 'success'
};

// --- HELPERS ---
function t(key) { return t_data[state.lang][key] || key; }
function nav(page) { state.page = page; render(); window.scrollTo(0,0); }
function toggleLang() { 
    state.lang = state.lang === 'en' ? 'ar' : 'en'; 
    document.body.dir = state.lang === 'ar' ? 'rtl' : 'ltr'; 
    if(state.lang === 'ar') document.body.classList.add('font-arabic'); 
    else document.body.classList.remove('font-arabic'); 
    render(); 
}
function toMorse(text) { return text.toLowerCase().split('').map(char => MORSE_CODE[char] || char).join(' '); }
function findProduct(id) { return state.products.find(p=>p.id===Number(id)); }

function setDraftMessage(val) {
    state.draftMessage = val;
    const mp = document.getElementById('mp');
    if(mp) mp.innerText = toMorse(val);
}
function setDraftLength(val) { state.draftLength = val; }

function addToCart(productId) { 
    const customText = state.draftMessage;
    const length = state.draftLength ? state.draftLength + '"' : "Standard";

    if(!customText) { flashMessage(t('fill_fields'), 'error'); return; }

    state.cart.push({
        productId, 
        quantity: 1, 
        customText: customText, 
        length: length
    });
    
    state.draftMessage = '';
    state.draftLength = '18';

    flashMessage(t('added_cart'), 'success'); 
    render(); 
}

function removeCartItem(index) { state.cart.splice(index, 1); render(); }
function clearCart() { state.cart=[]; render(); }
function cartItems() { 
    return state.cart.map((c, index) => { 
        const p = state.products.find(x => x.id === c.productId); 
        if(!p) return null; 
        return { ...p, ...c, cartIndex: index, sub: p.price * c.quantity }; 
    }).filter(Boolean); 
}

let flashTimer = null;
function flashMessage(msg, type='success', ms=3000){ state.message = msg; state.messageType = type; render(); if(flashTimer) clearTimeout(flashTimer); flashTimer=setTimeout(()=>{state.message=''; render();}, ms); }

function viewProduct(id) { 
    state.selectedProductId = Number(id); 
    state.draftMessage = ''; 
    state.draftLength = '18';
    state.page = 'product_detail'; 
    render(); 
    window.scrollTo(0,0); 
}

// --- AUTH ---
onAuthStateChanged(auth, user => {
    if (user) { currentUserId = user.uid; } 
    else { signInAnonymously(auth).then(cred => { currentUserId = cred.user.uid; }); }
    render();
});

// --- BACKEND ---
async function submitOrder(evt) {
    evt.preventDefault();
    const f = evt.target;
    
    const fullAddress = `Bldg ${f.building.value}, ${f.street.value}, ${f.district.value}, ${f.gov.value}, Fl ${f.floor.value}, Apt ${f.apt.value}`;
    
    if(!/^\d{11}$/.test(f.phone1.value)) { flashMessage(t('phone_error'), 'error'); return; }

    const sub = cartItems().reduce((s,it)=>s+it.sub,0);
    const ship = sub >= FREE_SHIPPING_THRESHOLD ? 0 : SHIPPING_COST;
    const total = sub + ship;

    const formattedItems = cartItems().map(item => {
        let details = item.name;
        if(item.customText) details += ` [Msg: ${item.customText}]`;
        if(item.length && item.length !== 'Standard') details += ` [Len: ${item.length}]`;
        return { ...item, name: details };
    });

    const orderData = {
        name: f.name.value, phone1: f.phone1.value, phone2: f.phone2.value,
        address: fullAddress, 
        items: formattedItems, 
        totalPrice: total, shippingFee: ship,
        paymentMethod: 'COD', currency: 'EGP'
    };

    try {
        await addDoc(collection(db,'orders'), {...orderData, userId:currentUserId, timestamp:serverTimestamp()});
        if(GOOGLE_SCRIPT_URL) fetch(GOOGLE_SCRIPT_URL, { method: "POST", mode: "no-cors", headers: {"Content-Type": "application/json"}, body: JSON.stringify(orderData) }).catch(console.error);
        
        state.cart = []; state.page='home'; state.showSuccessModal = true; render();
    } catch(e) { console.error(e); flashMessage(t('order_failed'), 'error'); }
}

async function submitContact(evt) {
    evt.preventDefault();
    const data = { name: evt.target.name.value, phone: evt.target.phone.value, msg: evt.target.message.value };
    await addDoc(collection(db,'contact_messages'), {...data, userId:currentUserId, timestamp:serverTimestamp()});
    evt.target.reset(); flashMessage(t('send_msg') + " Success", 'success');
}

// --- RENDERERS ---
const root = document.getElementById('root');
function escapeHtml(str){ if(!str) return ''; return String(str).replace(/[&<>"']/g,s=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s])); }

function renderNavbar() {
    const cartCount = state.cart.length;
    return `
    <div class="bg-red-700 text-white text-[10px] uppercase font-bold text-center py-2 tracking-[0.2em] animate-pulse">${t('shipping_banner')}</div>
    <nav class="bg-white/95 backdrop-blur-md sticky top-0 z-30 border-b border-gray-100">
        <div class="max-w-7xl mx-auto px-6 py-4 flex flex-col md:flex-row items-center justify-between gap-4">
            <div class="flex items-center gap-6 w-full md:w-auto">
                <div class="flex items-center gap-3 cursor-pointer group" onclick="window._app.nav('home')">
                    <img src="./morse_logo_transparent.png" class="h-12 w-auto object-contain transition-transform group-hover:scale-95">
                    <span class="text-2xl font-heading font-bold text-gray-900 tracking-widest">${t('title')}</span>
                </div>
            </div>
            <div class="flex items-center gap-6 w-full md:w-auto justify-end">
                 <div class="hidden md:flex items-center gap-6 text-xs uppercase tracking-widest font-bold text-gray-500">
                    <button onclick="window._app.nav('home')" class="hover:text-black transition">${t('shop')}</button>
                    <button onclick="window._app.nav('gallery')" class="hover:text-black transition">${t('gallery')}</button>
                </div>

                <div class="flex items-center gap-4">
                    <button onclick="window._app.toggleLang()" class="text-xs font-bold text-gray-900 border border-gray-900 px-2 py-1 hover:bg-gray-900 hover:text-white transition">${state.lang==='en'?'AR':'EN'}</button>
                    <button onclick="window._app.nav('cart')" class="relative text-gray-900 hover:opacity-70 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" /></svg>
                        ${cartCount ? `<span class="absolute -top-1 -right-1 flex items-center justify-center w-4 h-4 text-[9px] font-bold text-white bg-black rounded-full">${cartCount}</span>` : ''}
                    </button>
                </div>
            </div>
        </div>
    </nav>`;
}

function renderHome() {
    return `
    <section class="fade-in">
        <div class="relative bg-gray-100 py-16 px-4 mb-16 text-center">
            <h1 class="text-4xl md:text-6xl font-bold text-gray-900 mb-4 tracking-widest">${t('hero_title')}</h1>
            <p class="text-gray-600 tracking-wide text-lg font-light">${t('hero_sub')}</p>
        </div>

        <div class="max-w-7xl mx-auto px-4">
            <div class="bg-white border border-gray-100 p-8 md:p-12 mb-20 flex flex-col md:flex-row items-center gap-12 shadow-sm">
                <div class="flex-1 w-full img-zoom-container bg-gray-50 p-4">
                    <img src="./morse_code.png" class="w-full h-auto object-contain mix-blend-multiply">
                </div>
                <div class="flex-1 space-y-6 text-center md:text-left">
                    <h2 class="text-3xl text-gray-900 tracking-widest">${t('morse_title')}</h2>
                    <div class="w-12 h-0.5 bg-black mx-auto md:mx-0"></div>
                    <p class="text-gray-500 font-light leading-relaxed">${t('morse_desc_1')}</p>
                    <p class="text-gray-500 font-light leading-relaxed">${t('morse_desc_2')}</p>
                    <p class="text-sm font-bold text-gray-900 uppercase tracking-widest mt-4">${t('morse_secret')}</p>
                </div>
            </div>

            <div class="flex items-center justify-between mb-8 border-b border-gray-200 pb-4">
                <h2 class="text-xl font-bold text-gray-900 tracking-widest">${t('collection')}</h2>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-x-8 gap-y-12 mb-24">
                ${state.products.map(p => `
                <article class="product-card group cursor-pointer" onclick="window._app.viewProduct(${p.id})">
                    <div class="img-zoom-container bg-gray-50 aspect-[4/5] mb-4 relative overflow-hidden">
                        <img src="${escapeHtml(p.image)}" class="w-full h-full object-cover">
                        <div class="absolute top-2 left-2 bg-red-600 text-white text-[10px] font-bold px-2 py-1 uppercase tracking-widest z-10">${t('sale_tag')}</div>
                        <div class="absolute inset-0 bg-black/0 group-hover:bg-black/5 transition-colors duration-500"></div>
                        <button class="absolute bottom-4 left-1/2 -translate-x-1/2 bg-white text-black text-xs font-bold uppercase tracking-widest py-3 px-6 opacity-0 group-hover:opacity-100 transition-all duration-500 translate-y-4 group-hover:translate-y-0 shadow-lg hover:bg-black hover:text-white w-[80%]">
                            ${t('customize')}
                        </button>
                    </div>
                    <div class="text-center">
                        <h3 class="text-sm font-medium text-gray-900 uppercase tracking-wide mb-1">${escapeHtml(p.name)}</h3>
                        <div class="space-x-2 text-sm">
                            <span class="text-red-500 line-through font-light">${p.originalPrice}</span>
                            <span class="text-gray-900 font-bold">${p.price} ${t('original_price')}</span>
                        </div>
                    </div>
                </article>`).join('')}
            </div>
        </div>
    </section>`;
}

function renderProductDetail() {
    const p = state.products.find(x => x.id === state.selectedProductId);
    const others = state.products.filter(x => x.id !== p.id);
    const isNecklace = p.category === 'necklace';

    return `
    <section class="py-12 px-4 max-w-7xl mx-auto fade-in">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-16">
            <div class="bg-gray-50 p-8 flex items-center justify-center relative">
                 <button onclick="window._app.nav('home')" class="absolute top-4 left-4 text-gray-400 hover:text-black flex items-center gap-2 text-xs uppercase tracking-widest transition">
                    ${state.lang==='ar'?'&rarr;':'&larr;'} ${t('back_shop')}
                </button>
                <img src="${escapeHtml(p.image)}" class="max-h-[600px] w-auto object-contain shadow-sm drop-shadow-2xl">
            </div>

            <div class="flex flex-col justify-center">
                <span class="text-xs text-red-600 font-bold uppercase tracking-[0.2em] mb-2">${t('sale_tag')} - Limited Time</span>
                <h1 class="text-4xl text-gray-900 mb-4 tracking-wide">${escapeHtml(p.name)}</h1>
                <p class="text-gray-500 font-light leading-relaxed mb-8 text-lg">${escapeHtml(p.description)}</p>
                
                <div class="flex items-center gap-4 mb-8">
                     <span class="text-3xl font-heading text-gray-900">${p.price} <span class="text-sm align-top">${t('original_price')}</span></span>
                     <span class="text-lg text-red-500 line-through font-light">${p.originalPrice}</span>
                </div>

                <div class="space-y-6 border-t border-b border-gray-100 py-8 mb-8">
                    
                    <div>
                        <label class="block text-xs font-bold text-gray-900 uppercase tracking-widest mb-3">${t('custom_title')}</label>
                        <input id="custom-text-input" type="text" maxlength="10" placeholder="e.g. LOVE" 
                            value="${state.draftMessage}"
                            class="w-full p-4 bg-gray-50 border-b-2 border-gray-200 focus:border-black outline-none text-lg uppercase tracking-widest transition" 
                            oninput="window._app.setDraftMessage(this.value)">
                        <div class="flex justify-between items-start mt-2">
                             <span class="text-xs text-gray-400">${t('custom_hint')}</span>
                             <div id="mp" class="text-xl font-bold text-gray-900 tracking-[0.2em] h-6">${toMorse(state.draftMessage)}</div>
                        </div>
                    </div>

                    ${isNecklace ? `
                    <div class="relative">
                        <div class="flex justify-between items-center mb-3">
                            <label class="block text-xs font-bold text-gray-900 uppercase tracking-widest">${t('length_label')} (Inches)</label>
                            <button onclick="window._app.toggleSizeGuide()" class="text-xs text-gray-500 underline hover:text-black">${t('length_guide')}</button>
                        </div>
                        <select id="length-select" onchange="window._app.setDraftLength(this.value)" class="w-full p-4 bg-gray-50 border border-gray-200 outline-none text-sm cursor-pointer appearance-none">
                            <option value="18" ${state.draftLength === '18' ? 'selected' : ''}>18" (Standard)</option>
                            <option value="20" ${state.draftLength === '20' ? 'selected' : ''}>20"</option>
                            <option value="22" ${state.draftLength === '22' ? 'selected' : ''}>22"</option>
                            <option value="24" ${state.draftLength === '24' ? 'selected' : ''}>24"</option>
                            <option value="30" ${state.draftLength === '30' ? 'selected' : ''}>30"</option>
                        </select>
                        <div class="absolute right-4 top-[2.8rem] pointer-events-none">
                            <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </div>

                        <div class="${state.showSizeGuide ? 'block' : 'hidden'} mt-4 p-4 bg-white border border-gray-100 shadow-xl absolute z-10 w-full left-0 transition-all duration-300">
                             <div class="flex justify-between mb-2">
                                <span class="text-xs font-bold">SIZE REFERENCE</span>
                                <button onclick="window._app.toggleSizeGuide()" class="text-xs">âœ•</button>
                             </div>
                             <img src="./length.png" class="w-full h-auto"> 
                        </div>
                    </div>
                    ` : ''}

                </div>

                <button onclick="window._app.addToCart(${p.id})" 
                class="w-full py-4 bg-gray-900 text-white text-sm font-bold uppercase tracking-widest hover:bg-black transition-colors duration-300 shadow-lg flex items-center justify-center gap-2">
                    ${t('add_cart')}
                </button>
            </div>
        </div>

        <div class="mt-24 border-t border-gray-100 pt-16">
            <h3 class="text-xl font-heading font-bold mb-8 text-center">${t('you_like')}</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                ${others.map(o => `
                <div class="group cursor-pointer" onclick="window._app.viewProduct(${o.id})">
                    <div class="bg-gray-50 aspect-square mb-3 overflow-hidden">
                        <img src="${escapeHtml(o.image)}" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110 opacity-90 group-hover:opacity-100">
                    </div>
                    <div class="text-center">
                         <h4 class="text-xs font-bold uppercase tracking-wide truncate">${escapeHtml(o.name)}</h4>
                         <span class="text-xs text-red-500">${o.price} ${t('original_price')}</span>
                    </div>
                </div>`).join('')}
            </div>
        </div>
    </section>`;
}

function renderCart() {
    const items = cartItems();
    const sub = items.reduce((a,b)=>a+b.sub,0);
    const ship = sub >= FREE_SHIPPING_THRESHOLD ? 0 : SHIPPING_COST;
    const total = sub + ship;

    if(items.length===0) return `<div class="flex-1 flex flex-col items-center justify-center fade-in text-center p-8"><h2 class="text-2xl font-heading mb-4 text-gray-300">${t('cart_empty')}</h2><button onclick="window._app.nav('home')" class="border-b border-black pb-1 text-sm uppercase tracking-widest hover:text-gray-600 transition">${t('shop_now')}</button></div>`;

    return `
    <section class="py-16 px-4 max-w-5xl mx-auto w-full fade-in">
        <h2 class="text-3xl font-heading mb-12 text-center tracking-widest">${t('your_cart')}</h2>
        
        <div class="flex flex-col lg:flex-row gap-12">
            <div class="flex-1 space-y-8">
                ${items.map((i, idx) => `
                <div class="flex gap-6 border-b border-gray-50 pb-6">
                    <div class="w-24 h-24 bg-gray-50 flex-shrink-0">
                        <img src="${escapeHtml(i.image)}" class="w-full h-full object-cover">
                    </div>
                    <div class="flex-1 flex flex-col justify-between">
                        <div>
                            <div class="flex justify-between items-start">
                                <h3 class="font-bold text-sm uppercase tracking-wide">${escapeHtml(i.name)}</h3>
                                <button onclick="window._app.removeCartItem(${idx})" class="text-xs text-gray-400 hover:text-red-500 transition">Remove</button>
                            </div>
                            <div class="mt-1 space-y-1">
                                <p class="text-xs text-gray-500"><span class="font-bold text-gray-900">Message:</span> ${i.customText}</p>
                                <p class="text-xs text-gray-500"><span class="font-bold text-gray-900">Length:</span> ${i.length}</p>
                            </div>
                        </div>
                        <div class="flex justify-between items-end mt-4">
                            <span class="text-sm font-bold">${i.price} ${t('original_price')}</span>
                        </div>
                    </div>
                </div>`).join('')}
                
                <button onclick="window._app.clearCart()" class="text-xs text-gray-400 underline hover:text-gray-900">${t('clear_cart')}</button>
            </div>

            <div class="w-full lg:w-80 bg-gray-50 p-8 h-fit space-y-6">
                <h3 class="font-heading font-bold text-lg border-b border-gray-200 pb-4">Order Summary</h3>
                <div class="space-y-3 text-sm">
                    <div class="flex justify-between text-gray-600"><span>${t('subtotal')}</span><span>${sub} ${t('original_price')}</span></div>
                    <div class="flex justify-between text-gray-600"><span>${t('shipping')}</span><span class="${ship===0?'text-green-600 font-bold':''}">${ship===0?t('free'):ship}</span></div>
                </div>
                <div class="flex justify-between text-lg font-bold border-t border-gray-200 pt-4"><span>${t('total')}</span><span>${total} ${t('original_price')}</span></div>
                <button onclick="window._app.nav('checkout')" class="w-full py-4 bg-black text-white text-xs font-bold uppercase tracking-widest hover:bg-gray-800 transition shadow-lg">${t('proceed')}</button>
            </div>
        </div>
    </section>`;
}

function renderCheckout() {
    const items = cartItems();
    if(items.length===0) return nav('home');
    const sub = items.reduce((a,b)=>a+b.sub,0);
    const ship = sub >= FREE_SHIPPING_THRESHOLD ? 0 : SHIPPING_COST;
    const total = sub + ship;

    return `
    <section class="py-12 px-4 max-w-2xl mx-auto fade-in">
        <h2 class="text-2xl font-heading mb-8 text-center tracking-widest">${t('checkout_title')}</h2>
        <form onsubmit="window._app.submitOrder(event)" class="space-y-8">
            
            <div class="space-y-4">
                <h3 class="text-xs font-bold text-gray-400 uppercase tracking-widest border-b border-gray-100 pb-2">Contact Details</h3>
                <input name="name" placeholder="${t('full_name')}" class="w-full p-3 bg-transparent border border-gray-200 focus:border-black outline-none text-sm transition" required>
                <div class="grid grid-cols-2 gap-4">
                    <input name="phone1" placeholder="${t('phone_1')}" class="w-full p-3 bg-transparent border border-gray-200 focus:border-black outline-none text-sm transition" required type="tel" maxlength="11">
                    <input name="phone2" placeholder="${t('phone_2')}" class="w-full p-3 bg-transparent border border-gray-200 focus:border-black outline-none text-sm transition" type="tel">
                </div>
            </div>
            
            <div class="space-y-4">
                <h3 class="text-xs font-bold text-gray-400 uppercase tracking-widest border-b border-gray-100 pb-2">${t('address_section')}</h3>
                <div class="grid grid-cols-2 gap-4">
                    <select name="gov" class="w-full p-3 bg-transparent border border-gray-200 focus:border-black outline-none text-sm transition" required>
                        <option value="">${t('gov_label')}</option>${GOVERNORATES.map(g=>`<option value="${g}">${g}</option>`).join('')}
                    </select>
                    <input name="district" placeholder="${t('district_label')}" class="w-full p-3 bg-transparent border border-gray-200 focus:border-black outline-none text-sm transition" required>
                    <input name="street" placeholder="${t('street_label')}" class="col-span-2 w-full p-3 bg-transparent border border-gray-200 focus:border-black outline-none text-sm transition" required>
                    <input name="building" placeholder="${t('building_label')}" class="w-full p-3 bg-transparent border border-gray-200 focus:border-black outline-none text-sm transition" required>
                    <div class="flex gap-4">
                        <input name="floor" placeholder="${t('floor_label')}" class="w-full p-3 bg-transparent border border-gray-200 focus:border-black outline-none text-sm transition" required>
                        <input name="apt" placeholder="${t('apt_label')}" class="w-full p-3 bg-transparent border border-gray-200 focus:border-black outline-none text-sm transition" required>
                    </div>
                </div>
            </div>

            <div class="bg-gray-50 p-6 flex items-center gap-4 border border-gray-100">
                <div class="w-5 h-5 rounded-full border-[6px] border-black"></div>
                <div>
                    <p class="font-bold text-sm uppercase tracking-wide">${t('pay_cod')}</p>
                    <p class="text-xs text-gray-500">${t('cod_desc')}</p>
                </div>
            </div>

            <button type="submit" class="w-full py-4 bg-black text-white font-bold uppercase tracking-widest hover:bg-gray-900 transition shadow-xl mt-8 flex justify-between px-8 items-center group">
                <span>${t('place_order')}</span>
                <span class="group-hover:translate-x-1 transition-transform">${total} ${t('original_price')} &rarr;</span>
            </button>
        </form>
    </section>`;
}

function renderGallery() {
    return `
    <section class="py-16 px-4 max-w-7xl mx-auto text-center fade-in">
        <h1 class="text-4xl font-heading font-bold mb-4 tracking-widest">${t('spotlight')}</h1>
        <p class="text-gray-500 mb-12 font-light italic">${t('spotlight_sub')}</p>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-1">
            ${state.products.map(p => `
            <div class="aspect-square relative group overflow-hidden cursor-pointer" onclick="window._app.viewProduct(${p.id})">
                <img src="${escapeHtml(p.image)}" class="w-full h-full object-cover transition duration-1000 group-hover:scale-110 filter grayscale group-hover:grayscale-0">
                <div class="absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition duration-500">
                    <span class="border border-white text-white px-6 py-2 text-xs font-bold uppercase tracking-widest hover:bg-white hover:text-black transition">${t('shop_now')}</span>
                </div>
            </div>`).join('')}
        </div>
    </section>`;
}

function renderContact() {
    return `
    <section class="py-20 px-4 max-w-lg mx-auto fade-in">
        <h2 class="text-3xl font-heading font-bold text-center mb-8 tracking-widest">${t('contact_us')}</h2>
        <form onsubmit="window._app.submitContact(event)" class="space-y-6">
            <input name="name" placeholder="${t('full_name')}" class="w-full p-4 bg-gray-50 border-b border-gray-200 focus:border-black outline-none transition" required>
            <input name="phone" placeholder="${t('phone_1')}" class="w-full p-4 bg-gray-50 border-b border-gray-200 focus:border-black outline-none transition" required>
            <textarea name="message" placeholder="Message..." class="w-full p-4 bg-gray-50 border-b border-gray-200 focus:border-black outline-none transition h-32" required></textarea>
            <button class="w-full py-4 bg-black text-white text-sm font-bold uppercase tracking-widest hover:bg-gray-800 transition">${t('send_msg')}</button>
        </form>
    </section>`;
}

function renderFooter() {
    return `
    <footer class="bg-gray-900 text-white py-16 mt-auto">
        <div class="max-w-7xl mx-auto px-6 flex flex-col md:flex-row justify-between items-center gap-8">
            <div class="text-center md:text-left">
                <h4 class="text-2xl font-heading font-bold tracking-widest">${t('title')}</h4>
                <div class="text-xs text-gray-500 mt-2 uppercase tracking-wide">&copy; 2025 Handcrafted in Cairo.</div>
                <button onclick="window._app.togglePolicyModal()" class="text-xs text-gray-400 hover:text-white mt-4 border-b border-gray-700 pb-0.5 transition">${t('policy_link')}</button>
            </div>
            <div class="flex flex-col items-center md:items-end gap-4">
                <a href="https://wa.me/201281770085" target="_blank" class="flex items-center gap-3 text-sm text-gray-400 hover:text-white transition">
                    <span>WhatsApp Concierge</span>
                    <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                </a>
                <a href="https://www.instagram.com/2annyyy" target="_blank" class="text-sm text-gray-400 hover:text-pink-400 transition">@2annyyy on Instagram</a>
            </div>
        </div>
    </footer>`;
}

function renderModals() {
    let html = '';
    if(state.showSuccessModal) {
        html += `<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm transition-opacity"><div class="bg-white p-12 text-center max-w-sm m-4 shadow-2xl animate-[fadeIn_0.5s_ease-out]"><div class="w-16 h-16 border-2 border-gray-900 rounded-full flex items-center justify-center mx-auto mb-6 text-2xl">âœ¨</div><h3 class="text-2xl font-heading font-bold mb-4 tracking-wide">${t('order_success_title')}</h3><p class="text-gray-500 mb-8 font-light">${t('order_success_msg')}</p><button onclick="window._app.closeSuccessModal()" class="w-full py-3 bg-black text-white text-xs font-bold uppercase tracking-widest hover:bg-gray-800 transition">${t('close')}</button></div></div>`;
    }
    if(state.showPolicyModal) {
        html += `<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4"><div class="bg-white p-8 max-w-lg w-full relative max-h-[80vh] overflow-y-auto shadow-2xl animate-[fadeIn_0.3s_ease-out]"><button onclick="window._app.togglePolicyModal()" class="absolute top-4 right-4 text-2xl hover:rotate-90 transition duration-300">Ã—</button><h3 class="font-heading font-bold text-xl mb-6 tracking-widest border-b border-gray-100 pb-4">${t('policy_title')}</h3><div class="space-y-4 text-sm text-gray-600 font-light leading-relaxed"><p><strong class="text-gray-900">Delivery:</strong> 3-5 Business Days across Egypt.</p><p><strong class="text-gray-900">Returns:</strong> Due to the personalized nature of Morse code jewelry, returns are only accepted for defects.</p><p><strong class="text-gray-900">Care:</strong> Avoid direct contact with perfume and water to maintain luster.</p></div></div></div>`;
    }
    return html;
}

function render() {
    root.innerHTML = `<div class="min-h-screen flex flex-col font-body">${renderNavbar()}<main class="flex-1">${(state.page==='home'?renderHome():(state.page==='cart'?renderCart():(state.page==='checkout'?renderCheckout():(state.page==='product_detail'?renderProductDetail():(state.page==='gallery'?renderGallery():renderContact())))))}</main>${renderFooter()}${state.message?`<div class="fixed top-6 left-1/2 -translate-x-1/2 ${state.messageType==='success'?'bg-green-800':'bg-red-800'} text-white px-8 py-3 shadow-2xl z-50 text-xs font-bold uppercase tracking-widest animate-[fadeIn_0.3s_ease-out]">${state.message}</div>`:''}${renderModals()}</div>`;
}

// --- INIT ---
window._app = { 
    state, nav, toggleLang, viewProduct, addToCart, removeCartItem, clearCart, toMorse, submitOrder, submitContact, setDraftMessage, setDraftLength,
    togglePolicyModal: () => { state.showPolicyModal = !state.showPolicyModal; render(); }, 
    toggleSizeGuide: () => { state.showSizeGuide = !state.showSizeGuide; render(); },
    closeSuccessModal: () => { state.showSuccessModal = false; render(); } 
};

</script>
</body>
</html>
