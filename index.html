<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gleam & Co. | Morse Code Jewelry (Modular Firebase)</title>

  <!-- Favicon -->
  <link rel="icon" href="pics/morse code logo.png" type="image/png">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body { font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
    .hidden-until-ready { opacity: 0; transition: opacity .25s ease-in; }
    .visible-ready { opacity: 1; }
  </style>
</head>
<body class="bg-gray-50">

  <div id="root" class="hidden-until-ready"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-analytics.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDHRFiiklg8k8gmt1QGEstSM5hfTJvIZW8",
      authDomain: "morse-code-jewelry.firebaseapp.com",
      projectId: "morse-code-jewelry",
      storageBucket: "morse-code-jewelry.firebasestorage.app",
      messagingSenderId: "1034331508828",
      appId: "1:1034331508828:web:08acf02e2363000e99d699",
      measurementId: "G-C4WH6X1N1Z"
    };

    const app = initializeApp(firebaseConfig);
    try { getAnalytics(app); } catch(e) { console.info("Analytics init skipped or unavailable:", e?.message || e); }

    const auth = getAuth(app);
    const db = getFirestore(app);

    let currentUserId = null;
    const state = {
      page: 'home',
      cart: [],
      products: [
        { id: 1, name: 'Gold Morse Code Necklace', price: 159.99, description: 'Elegant gold bar necklace encoding a message in dots and dashes.', image: 'pics/golden necklace.avif' },
        { id: 2, name: 'Gold Morse Code Bracelet', price: 99.50, description: 'Delicate 14k gold bracelet with a Morse code message.', image: 'pics/golden bracelet.avif' },
        { id: 3, name: 'Silver Morse Code Necklace', price: 139.00, description: 'Polished silver necklace with a hidden message pattern.', image: 'pics/silver necklace.png' },
        { id: 4, name: 'Silver Cord Bracelet Set', price: 89.00, description: 'Cord bracelet set with silver beads for customization.', image: 'pics/silver bracelet.webp' },
      ],
      message: '',
      isAuthReady: false,
    };

    async function ensureAnonymousSignIn() {
      onAuthStateChanged(auth, user => {
        if (user) { currentUserId = user.uid; state.isAuthReady = true; render(); }
        else { signInAnonymously(auth).then(cred => { currentUserId = cred.user.uid; state.isAuthReady = true; render(); }); }
      });
    }
    ensureAnonymousSignIn();

    function findProduct(id) { return state.products.find(p => p.id === Number(id)); }
    function addToCart(productId) { const existing = state.cart.find(i => i.productId === productId); if (existing) existing.quantity++; else state.cart.push({ productId, quantity: 1 }); flashMessage('Added to cart'); render(); }
    function updateQuantity(productId, qty) { if (qty <= 0) { state.cart = state.cart.filter(i => i.productId !== productId); } else { const item = state.cart.find(i => i.productId === productId); if (item) item.quantity = qty; } render(); }
    function clearCart() { state.cart = []; flashMessage('Cart cleared'); render(); }
    function cartItems() { return state.cart.map(ci => { const p = findProduct(ci.productId); if (!p) return null; return { ...p, quantity: ci.quantity, subtotal: +(p.price * ci.quantity).toFixed(2) }; }).filter(Boolean); }
    function cartTotal() { return cartItems().reduce((s,it)=>s+it.subtotal,0); }
    let flashTimer = null;
    function flashMessage(msg, ms=3000){ state.message=msg; render(); if(flashTimer) clearTimeout(flashTimer); flashTimer=setTimeout(()=>{state.message=''; render();},ms); }

    async function submitOrderToFirestore(orderData){ try{ const colRef=collection(db,'orders'); await addDoc(colRef,{...orderData,userId:currentUserId,timestamp:serverTimestamp()}); flashMessage('Order submitted — thank you!'); return true; }catch(e){ flashMessage('Order failed'); return false; }}
    async function submitContactToFirestore(contactData){ try{ const colRef=collection(db,'contact_messages'); await addDoc(colRef,{...contactData,userId:currentUserId,timestamp:serverTimestamp()}); flashMessage('Message sent — thanks!'); return true; }catch(e){ flashMessage('Message failed'); return false; }}

    const root = document.getElementById('root');
    function escapeHtml(str){ if(!str) return ''; return String(str).replace(/[&<>"']/g,s=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s])); }

    function renderNavbar() {
      const cartCount = state.cart.reduce((s,i)=>s+i.quantity,0);
      return `
        <nav class="bg-white shadow sticky top-0 z-20">
          <div class="max-w-7xl mx-auto px-4 py-4 flex flex-col items-center">
            <img src="pics/morse code logo.png" alt="Gleam & Co. Logo" class="h-16 mb-2" />
            <div class="flex space-x-4">
              <button data-nav="home" class="text-sm text-gray-700 hover:text-pink-600">Shop</button>
              <button data-nav="gallery" class="text-sm text-gray-700 hover:text-pink-600">Gallery</button>
              <button data-nav="contact" class="text-sm text-gray-700 hover:text-pink-600">Contact</button>
              <button data-nav="cart" class="relative p-2 text-gray-700 hover:text-pink-600">
                <svg xmlns="http://www.w3.org/2000/svg" class="inline h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17"/>
                </svg>
                ${cartCount?`<span class="absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-red-100 transform translate-x-1/2 -translate-y-1/2 bg-pink-600 rounded-full">${cartCount}</span>`:''}
              </button>
            </div>
          </div>
        </nav>
      `;
    }

    // Home, gallery, cart, checkout, contact, footer functions remain unchanged except images replaced as above

    function renderHome(){ return `
      <section class="py-12 px-4 max-w-7xl mx-auto">
        <h1 class="text-4xl font-extrabold text-gray-900 text-center mb-4">Personalized Morse Code Jewelry</h1>
        <p class="text-lg text-gray-600 text-center mb-8">Convert any name or secret message into a beautiful, wearable piece.</p>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          ${state.products.map(p=>`
            <article class="bg-white rounded-xl shadow-sm overflow-hidden">
              <img src="${escapeHtml(p.image)}" alt="${escapeHtml(p.name)}" class="w-full h-48 object-cover" />
              <div class="p-4">
                <h3 class="text-lg font-semibold">${escapeHtml(p.name)}</h3>
                <p class="text-sm text-gray-500 h-12 overflow-hidden">${escapeHtml(p.description)}</p>
                <div class="mt-4 flex items-center justify-between">
                  <strong class="text-pink-600 text-xl">$${p.price.toFixed(2)}</strong>
                  <button data-add-product="${p.id}" class="px-4 py-2 bg-pink-600 text-white rounded-lg">Add to Cart</button>
                </div>
              </div>
            </article>
          `).join('')}
        </div>
      </section>
    `;}

    // Other render functions (Gallery, Cart, Checkout, Contact, Footer) remain the same, just ensure images use state.products[*].image

    function render() {
      const readyClass = state.isAuthReady ? 'visible-ready' : 'hidden-until-ready';
      root.className = readyClass;
      root.innerHTML = `
        <div class="min-h-screen flex flex-col">
          ${renderNavbar()}
          <main class="flex-1">
            ${state.page==='home'?renderHome():''}
            ${state.page==='gallery'?renderGallery():''}
            ${state.page==='contact'?renderContact():''}
            ${state.page==='cart'?renderCart():''}
            ${state.page==='checkout'?renderCheckout():''}
          </main>
          ${renderFooter()}
          ${state.message?`<div id="flash" class="fixed top-6 left-1/2 transform -translate-x-1/2 bg-pink-600 text-white px-6 py-2 rounded shadow">${escapeHtml(state.message)}</div>`:''}
        </div>
      `;

      document.querySelectorAll('[data-nav]').forEach(btn=>btn.onclick=()=>{ state.page=btn.getAttribute('data-nav'); render(); window.scrollTo(0,0); });
      document.querySelectorAll('[data-add-product]').forEach(btn=>btn.onclick=()=>addToCart(Number(btn.getAttribute('data-add-product'))));
      document.querySelectorAll('[data-cart-qty]').forEach(input=>input.onchange=()=>updateQuantity(Number(input.getAttribute('data-cart-qty')), parseInt(input.value)||0));
      const clearBtn=document.getElementById('btn-clear-cart'); if(clearBtn) clearBtn.onclick=clearCart;
      const checkoutForm=document.getElementById('checkout-form'); if(checkoutForm) checkoutForm.onsubmit=handleCheckoutSubmit;
      const contactForm=document.getElementById('contact-form'); if(contactForm) contactForm.onsubmit=handleContactSubmit;
    }

    render();
  </script>
</body>
</html>
