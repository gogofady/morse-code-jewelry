<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gleam & Co. | Morse Code Jewelry</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React + ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Firebase (compat version for browser use) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body class="bg-gray-50">

<div id="root"></div>

<script type="text/babel">

// -----------------------------
// Firebase Initialization
// -----------------------------
const firebaseConfig = {
  apiKey: "AIzaSyBPFHirKiLqk8gmt1QGEStM5HfTJvIZw8",
  authDomain: "morse-code-jewelry.firebaseapp.com",
  projectId: "morse-code-jewelry",
  storageBucket: "morse-code-jewelry.appspot.com",
  messagingSenderId: "1034331508828",
  appId: "1:1034331508828:web:08acf02e2363000e99d6d9",
  measurementId: "G-C4WH6XN1IZ"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// -----------------------------
// React App
// -----------------------------
const { useState, useEffect, useMemo } = React;

const App = () => {
  const [page, setPage] = useState('home');
  const [cart, setCart] = useState([]);
  const [message, setMessage] = useState('');
  const [userId, setUserId] = useState(null);
  const [isAuthReady, setIsAuthReady] = useState(false);

  // Firebase anonymous sign-in
  useEffect(() => {
    auth.signInAnonymously()
      .then((cred) => {
        setUserId(cred.user.uid);
        setIsAuthReady(true);
        console.log("Anonymous user signed in:", cred.user.uid);
      })
      .catch(err => {
        console.error("Firebase auth error:", err);
        setIsAuthReady(true);
      });
  }, []);

  // Product data
  const initialProducts = useMemo(() => ([
    { id: 1, name: 'Gold Morse Code Necklace', price: 159.99, description: 'Elegant gold bar necklace, subtly encoding a name or message in dots and dashes.', image: 'https://placehold.co/400x300?text=Gold+Necklace' },
    { id: 2, name: 'Gold Morse Code Bracelet', price: 99.50, description: 'Delicate 14k gold chain bracelet, featuring a personalized Morse Code message.', image: 'https://placehold.co/400x300?text=Gold+Bracelet' },
    { id: 3, name: 'Silver Morse Code Necklace', price: 139.00, description: 'Polished silver necklace, transforming words into a sleek, customized pattern.', image: 'https://placehold.co/400x300?text=Silver+Necklace' },
    { id: 4, name: 'Silver Cord Bracelet Set', price: 89.00, description: 'Multiple cord bracelets with silver elements, customizable for personalized names.', image: 'https://placehold.co/400x300?text=Silver+Bracelet' },
  ]), []);

  // Cart calculations
  const cartItems = useMemo(() => {
    return cart.map(item => {
      const product = initialProducts.find(p => p.id === item.productId);
      if (!product) return null;
      return { ...product, quantity: item.quantity, subtotal: product.price * item.quantity };
    }).filter(item => item !== null);
  }, [cart, initialProducts]);

  const cartTotal = useMemo(() => {
    return cartItems.reduce((total, item) => total + item.subtotal, 0);
  }, [cartItems]);

  // Cart handlers
  const addToCart = (product) => {
    setCart(prev => {
      const existing = prev.find(i => i.productId === product.id);
      if (existing) {
        return prev.map(i => i.productId === product.id ? { ...i, quantity: i.quantity + 1 } : i);
      }
      return [...prev, { productId: product.id, quantity: 1 }];
    });
    setMessage(`${product.name} added to cart!`);
  };

  const updateQuantity = (productId, quantity) => {
    setCart(prev => {
      if (quantity <= 0) return prev.filter(i => i.productId !== productId);
      return prev.map(i => i.productId === productId ? { ...i, quantity } : i);
    });
  };

  const clearCart = () => {
    setCart([]);
    setMessage('Cart cleared.');
  };

  // Firestore submit functions
  const submitOrder = async (orderData) => {
    if (!db || !userId) {
      setMessage('Database not ready.');
      return;
    }
    try {
      const ordersRef = db.collection('orders');
      await ordersRef.add({ ...orderData, userId, timestamp: firebase.firestore.FieldValue.serverTimestamp() });
      setMessage('Order submitted!');
      clearCart();
      setPage('home');
    } catch (e) {
      console.error("Error submitting order:", e);
      setMessage('Order submission failed.');
    }
  };

  const submitContact = async (formData) => {
    if (!db || !userId) {
      setMessage('Database not ready.');
      return false;
    }
    try {
      const contactRef = db.collection('contact_messages');
      await contactRef.add({ ...formData, userId, timestamp: firebase.firestore.FieldValue.serverTimestamp() });
      setMessage('Message sent!');
      return true;
    } catch (e) {
      console.error("Error sending message:", e);
      setMessage('Message sending failed.');
      return false;
    }
  };

  // -----------------------------
  // UI Components
  // -----------------------------
  const Navbar = () => (
    <nav className="bg-white shadow-lg sticky top-0 z-10">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center h-16">
        <button onClick={() => setPage('home')} className="text-2xl font-bold text-pink-600 hover:text-pink-800">Gleam & Co.</button>
        <div className="flex space-x-4">
          <button onClick={() => setPage('home')} className={page==='home'?'font-bold text-pink-700':'text-gray-700'}>Shop</button>
          <button onClick={() => setPage('gallery')} className={page==='gallery'?'font-bold text-pink-700':'text-gray-700'}>Gallery</button>
          <button onClick={() => setPage('contact')} className={page==='contact'?'font-bold text-pink-700':'text-gray-700'}>Contact</button>
          <button onClick={() => setPage('cart')} className="relative">
            Cart {cart.length > 0 && <span className="absolute -top-2 -right-2 bg-red-500 text-white rounded-full px-2 text-xs">{cart.reduce((t,i)=>t+i.quantity,0)}</span>}
          </button>
        </div>
      </div>
    </nav>
  );

  const ProductCard = ({ product }) => (
    <div className="bg-white rounded-xl shadow-lg p-4">
      <img src={product.image} alt={product.name} className="w-full h-48 object-cover" />
      <h3 className="mt-2 font-semibold">{product.name}</h3>
      <p className="text-gray-500">{product.description}</p>
      <div className="flex justify-between mt-2 items-center">
        <span className="font-bold">${product.price.toFixed(2)}</span>
        <button className="bg-pink-600 text-white px-4 py-2 rounded" onClick={() => addToCart(product)}>Add</button>
      </div>
    </div>
  );

  const Home = () => (
    <div className="py-12 px-4 max-w-7xl mx-auto">
      <h1 className="text-4xl font-bold text-center mb-4">Personalized Morse Code Jewelry</h1>
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        {initialProducts.map(p => <ProductCard key={p.id} product={p} />)}
      </div>
    </div>
  );

  const Cart = () => (
    <div className="max-w-3xl mx-auto py-12 px-4">
      <h1 className="text-3xl font-bold mb-6">Shopping Cart</h1>
      {cartItems.length === 0 ? (
        <p>Cart is empty.</p>
      ) : (
        cartItems.map(item => (
          <div key={item.id} className="flex justify-between items-center mb-4 bg-white p-4 rounded shadow">
            <span>{item.name}</span>
            <input type="number" value={item.quantity} min="1" onChange={(e)=>updateQuantity(item.id, parseInt(e.target.value)||1)} className="w-16 p-1 border"/>
            <span>${item.subtotal.toFixed(2)}</span>
          </div>
        ))
      )}
      {cartItems.length > 0 && (
        <div className="mt-4 flex justify-between">
          <button className="px-4 py-2 border rounded" onClick={clearCart}>Clear Cart</button>
          <button className="px-4 py-2 bg-pink-600 text-white rounded" onClick={()=>setPage('checkout')}>Checkout</button>
        </div>
      )}
    </div>
  );

  const Checkout = () => {
    const [name, setName] = useState('');
    const [address, setAddress] = useState('');
    const [card, setCard] = useState('');
    const handleSubmit = async(e) => {
      e.preventDefault();
      const orderData = { customerName: name, address, items: cartItems.map(i=>({name:i.name, qty:i.quantity})), total: cartTotal };
      await submitOrder(orderData);
    };
    return (
      <div className="max-w-2xl mx-auto py-12 px-4">
        <h1 className="text-3xl font-bold mb-6">Checkout</h1>
        <form onSubmit={handleSubmit} className="space-y-4 bg-white p-6 rounded shadow">
          <input type="text" placeholder="Name" value={name} onChange={e=>setName(e.target.value)} className="w-full p-2 border rounded" required/>
          <textarea placeholder="Address" value={address} onChange={e=>setAddress(e.target.value)} className="w-full p-2 border rounded" required/>
          <input type="text" placeholder="Card number" value={card} onChange={e=>setCard(e.target.value)} className="w-full p-2 border rounded" required/>
          <button type="submit" className="bg-pink-600 text-white px-4 py-2 rounded">Pay ${cartTotal.toFixed(2)}</button>
        </form>
      </div>
    );
  };

  const ContactUs = () => {
    const [name, setName] = useState(''); const [email,setEmail] = useState(''); const [msg,setMsg]=useState('');
    const handleSubmit = async(e) => { e.preventDefault(); await submitContact({name,email,message:msg}); setName(''); setEmail(''); setMsg('');};
    return (
      <div className="max-w-xl mx-auto py-12 px-4">
        <h1 className="text-3xl font-bold mb-6">Contact Us</h1>
        <form onSubmit={handleSubmit} className="space-y-4 bg-white p-6 rounded shadow">
          <input type="text" placeholder="Name" value={name} onChange={e=>setName(e.target.value)} className="w-full p-2 border rounded" required/>
          <input type="email" placeholder="Email" value={email} onChange={e=>setEmail(e.target.value)} className="w-full p-2 border rounded" required/>
          <textarea placeholder="Message" value={msg} onChange={e=>setMsg(e.target.value)} className="w-full p-2 border rounded" required/>
          <button type="submit" className="bg-pink-600 text-white px-4 py-2 rounded">Send</button>
        </form>
      </div>
    );
  };

  const Gallery = () => (
    <div className="py-12 px-4 max-w-7xl mx-auto">
      <h1 className="text-3xl font-bold mb-6 text-center">Gallery</h1>
      <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
        {initialProducts.map(p => <img key={p.id} src={p.image} alt={p.name} className="w-full h-48 object-cover rounded"/>)}
      </div>
    </div>
  );

  const Footer = () => (
    <footer className="bg-gray-800 text-white py-6 mt-6 text-center">
      <p>&copy; {new Date().getFullYear()} Gleam & Co.</p>
      <p className="text-xs">Database: {isAuthReady?'Connected':'Initializing...'}</p>
    </footer>
  );

  const renderPage = () => {
    switch(page) {
      case 'cart': return <Cart />;
      case 'checkout': return <Checkout />;
      case 'contact': return <ContactUs />;
      case 'gallery': return <Gallery />;
      default: return <Home />;
    }
  };

  return (
    <div>
      <Navbar />
      {message && <div className="fixed top-20 left-1/2 transform -translate-x-1/2 bg-pink-500 text-white px-6 py-2 rounded">{message}</div>}
      {renderPage()}
      <Footer />
    </div>
  );
};

// Mount React App
ReactDOM.createRoot(document.getElementById('root')).render(<App />);
</script>

</body>
</html>
